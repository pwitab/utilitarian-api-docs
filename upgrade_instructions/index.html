



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Utilitarian Documentation">
      
      
      
        <meta name="author" content="Henrik Palmlund Wahlgren">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../images/favicon.ico">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-4.6.3">
    
    
      
        <title>Upgrading - Utilitarian Docs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.adb8469c.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="">
      
    
    
      <script src="../assets/javascripts/modernizr.86422ebf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="white" data-md-color-accent="">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#upgrade-instructions" tabindex="0" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Utilitarian Docs" aria-label="Utilitarian Docs" class="md-header-nav__button md-logo">
          
            <img alt="logo" src="../images/u9n_badge_on_light.svg" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Utilitarian Docs
            </span>
            <span class="md-header-nav__topic">
              
                Upgrading
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" aria-label="search" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="Utilitarian Docs" class="md-nav__button md-logo">
      
        <img alt="logo" src="../images/u9n_badge_on_light.svg" width="48" height="48">
      
    </a>
    Utilitarian Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Architecture
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Architecture
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../architecture/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../components/" title="Components" class="md-nav__link">
      Components
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Automatic Meter Readings
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Automatic Meter Readings
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../amr/" title="AMR in Utilitarian" class="md-nav__link">
      AMR in Utilitarian
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-2" type="checkbox" id="nav-3-2">
    
    <label class="md-nav__link" for="nav-3-2">
      Execution Environments
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-2">
        Execution Environments
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../execution_environments/execution_environments/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../execution_environments/generic_lis200/" title="Generic LIS200" class="md-nav__link">
      Generic LIS200
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../execution_environments/generic_corus/" title="Generic Corus" class="md-nav__link">
      Generic Corus
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../time/" title="Time in Utilitarian" class="md-nav__link">
      Time in Utilitarian
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../protocols/" title="Protocols" class="md-nav__link">
      Protocols
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" checked>
    
    <label class="md-nav__link" for="nav-5">
      On Premise
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        On Premise
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../installation/" title="Installation" class="md-nav__link">
      Installation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../component_settings/" title="Component Configuration" class="md-nav__link">
      Component Configuration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../docker_compose/" title="Setup using Docker Compose" class="md-nav__link">
      Setup using Docker Compose
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../using_https_on_api/" title="Use HTTPS" class="md-nav__link">
      Use HTTPS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../async_workers/" title="Async Workers" class="md-nav__link">
      Async Workers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../amr_um/" title="Messaging" class="md-nav__link">
      Messaging
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Upgrading
      </label>
    
    <a href="./" title="Upgrading" class="md-nav__link md-nav__link--active">
      Upgrading
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-backup" class="md-nav__link">
    1. Backup
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-close-down-services" class="md-nav__link">
    2. Close down services
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-close-down-utilitarian-api" class="md-nav__link">
    3. Close down Utilitarian API
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-pull-new-versions" class="md-nav__link">
    4. Pull new versions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-upgrade-docker-config" class="md-nav__link">
    5. Upgrade docker config
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-start-utilitarian-api" class="md-nav__link">
    6. Start Utilitarian API
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-run-migrations" class="md-nav__link">
    7. Run migrations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-compress-static-assets" class="md-nav__link">
    8. Compress static assets
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9-start-up-all-services" class="md-nav__link">
    9. Start up all services
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10-verify-upgrade" class="md-nav__link">
    10. Verify upgrade
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Utilitarian API Reference
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Utilitarian API Reference
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../api_docs/v_1_3_0.html" title="v1.3.0" class="md-nav__link">
      v1.3.0
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../api_docs/v_1_2_0.html" title="v1.2.0" class="md-nav__link">
      v1.2.0
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../api_docs/v_1_1_0.html" title="v1.1.0" class="md-nav__link">
      v1.1.0
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../api_docs/v_1_0_0.html" title="v1.0.0" class="md-nav__link">
      v1.0.0
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../pwit/" title="About Utilitarian" class="md-nav__link">
      About Utilitarian
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../open_source/" title="Open Source" class="md-nav__link">
      Open Source
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-backup" class="md-nav__link">
    1. Backup
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-close-down-services" class="md-nav__link">
    2. Close down services
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-close-down-utilitarian-api" class="md-nav__link">
    3. Close down Utilitarian API
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-pull-new-versions" class="md-nav__link">
    4. Pull new versions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-upgrade-docker-config" class="md-nav__link">
    5. Upgrade docker config
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-start-utilitarian-api" class="md-nav__link">
    6. Start Utilitarian API
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-run-migrations" class="md-nav__link">
    7. Run migrations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-compress-static-assets" class="md-nav__link">
    8. Compress static assets
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9-start-up-all-services" class="md-nav__link">
    9. Start up all services
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10-verify-upgrade" class="md-nav__link">
    10. Verify upgrade
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="upgrade-instructions">Upgrade instructions<a class="headerlink" href="#upgrade-instructions" title="Permanent link">#</a></h1>
<p>How to upgrade Utilitarian to a newer version.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>These instructions assume that you are able to take Utilitarian down for 
   maintenance and allow time for the migrations to run.
   If you need you Utilitarian instance to be up during the migration please contact
   us and we will create an upgrade strategy together.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>When upgrading Utilitarian API you might need to upgrade other Utilitarian 
   services. If you are unsure of which services that need upgrading, please 
   contact us.</p>
</div>
<h2 id="1-backup">1. Backup<a class="headerlink" href="#1-backup" title="Permanent link">#</a></h2>
<p>Take a backup of your database and verify the backup. This can be done using <code>pg_dump</code>.
<a href="https://www.postgresql.org/docs/10/app-pgdump.html">pg_dump documentation</a></p>
<p>If you have the ability to take a snapshot of your database server it is also recommended.</p>
<h2 id="2-close-down-services">2. Close down services<a class="headerlink" href="#2-close-down-services" title="Permanent link">#</a></h2>
<p>Close down all services that depend on the API. Most edge services will keep handling 
messages and they will be queued up in RabbitMQ for when the services come online again.</p>
<p>Example:</p>
<ul>
<li>Utilitarian DLMS Parser</li>
<li>Utilitarian Poster</li>
</ul>
<h2 id="3-close-down-utilitarian-api">3. Close down Utilitarian API<a class="headerlink" href="#3-close-down-utilitarian-api" title="Permanent link">#</a></h2>
<p>Close down Utilitarian API, beat process and all worker processes.</p>
<h2 id="4-pull-new-versions">4. Pull new versions<a class="headerlink" href="#4-pull-new-versions" title="Permanent link">#</a></h2>
<p>Pull down new image version of Utilitarian from the docker repository</p>
<div class="codehilite"><pre><span></span><code>docker pull quay.io/pwit/utilitarian:{version}
</code></pre></div>


<h2 id="5-upgrade-docker-config">5. Upgrade docker config<a class="headerlink" href="#5-upgrade-docker-config" title="Permanent link">#</a></h2>
<p>Upgrade run config, for example <code>docker-compose</code> files with the new image.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You also have to remember to update the beat-process and all worker processes since 
they are based on the utilitarian image.</p>
</div>
<h2 id="6-start-utilitarian-api">6. Start Utilitarian API<a class="headerlink" href="#6-start-utilitarian-api" title="Permanent link">#</a></h2>
<p>Start only the Utilitarian API processes.</p>
<h2 id="7-run-migrations">7. Run migrations<a class="headerlink" href="#7-run-migrations" title="Permanent link">#</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This command can take a long time</p>
</div>
<p>Depending on how you are running Utilitarian how you initiate the command to run 
migrations can be a bit different.</p>
<p>The command is:</p>
<div class="codehilite"><pre><span></span><code>python manage.py migrate
</code></pre></div>


<p>if you are using docker-compose you should run it like:</p>
<div class="codehilite"><pre><span></span><code>docker-compose <span class="nb">exec</span> utilitarian-api sh -c <span class="s2">&quot;python manage.py migrate&quot;</span>
</code></pre></div>


<h2 id="8-compress-static-assets">8. Compress static assets<a class="headerlink" href="#8-compress-static-assets" title="Permanent link">#</a></h2>
<p>Some upgrades might have changes to the static assets. It is good to run the compression 
again.</p>
<p>The command is:</p>
<div class="codehilite"><pre><span></span><code>python manage.py compress
</code></pre></div>


<p>if you are using docker-compose you should run it like:</p>
<div class="codehilite"><pre><span></span><code>docker-compose <span class="nb">exec</span> utilitarian-api sh -c <span class="s2">&quot;python manage.py compress&quot;</span>
</code></pre></div>


<h2 id="9-start-up-all-services">9. Start up all services<a class="headerlink" href="#9-start-up-all-services" title="Permanent link">#</a></h2>
<p>Now start up all remaining services to get back all functionality to Utilitarian.</p>
<h2 id="10-verify-upgrade">10. Verify upgrade<a class="headerlink" href="#10-verify-upgrade" title="Permanent link">#</a></h2>
<p>Verify that everything seems to be correct in the application. If you find an issue 
please contact us.</p>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../amr_um/" title="Messaging" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Messaging
              </span>
            </div>
          </a>
        
        
          <a href="../api_docs/v_1_3_0.html" title="v1.3.0" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                v1.3.0
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2019 Palmlund Wahlgren Innovative Technology AB
          </div>
        
        powered by
        <a href="https://www.mkdocs.org" target="_blank" rel="noopener">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/pwitab" target="_blank" rel="noopener" title="github" class="md-footer-social__link fa fa-github"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.c33a9706.js"></script>
      
      <script>app.initialize({version:"1.1",url:{base:".."}})</script>
      
    
  </body>
</html>